'use strict';

var GetIntrinsic = require('get-intrinsic');

var $TypeError = GetIntrinsic('%TypeError%');

var HasOwnProperty = require('es-abstract/2021/HasOwnProperty');
var ToNumeric = require('es-abstract/2021/ToNumeric');
var ToPrimitive = require('es-abstract/2021/ToPrimitive');
var ToString = require('es-abstract/2021/ToString');
var Type = require('es-abstract/2021/Type');

var NumberAdd = require('es-abstract/2021/Number/add');
var NumberBitwiseAND = require('es-abstract/2021/Number/bitwiseAND');
var NumberBitwiseOR = require('es-abstract/2021/Number/bitwiseOR');
var NumberBitwiseXOR = require('es-abstract/2021/Number/bitwiseXOR');
var NumberDivide = require('es-abstract/2021/Number/divide');
var NumberExponentiate = require('es-abstract/2021/Number/exponentiate');
var NumberLeftShift = require('es-abstract/2021/Number/leftShift');
var NumberMultiply = require('es-abstract/2021/Number/multiply');
var NumberRemainder = require('es-abstract/2021/Number/remainder');
var NumberSignedRightShift = require('es-abstract/2021/Number/signedRightShift');
var NumberSubtract = require('es-abstract/2021/Number/subtract');
var NumberUnsignedRightShift = require('es-abstract/2021/Number/unsignedRightShift');
var BigIntAdd = require('es-abstract/2021/BigInt/add');
var BigIntBitwiseAND = require('es-abstract/2021/BigInt/bitwiseAND');
var BigIntBitwiseOR = require('es-abstract/2021/BigInt/bitwiseOR');
var BigIntBitwiseXOR = require('es-abstract/2021/BigInt/bitwiseXOR');
var BigIntDivide = require('es-abstract/2021/BigInt/divide');
var BigIntExponentiate = require('es-abstract/2021/BigInt/exponentiate');
var BigIntLeftShift = require('es-abstract/2021/BigInt/leftShift');
var BigIntMultiply = require('es-abstract/2021/BigInt/multiply');
var BigIntRemainder = require('es-abstract/2021/BigInt/remainder');
var BigIntSignedRightShift = require('es-abstract/2021/BigInt/signedRightShift');
var BigIntSubtract = require('es-abstract/2021/BigInt/subtract');
var BigIntUnsignedRightShift = require('es-abstract/2021/BigInt/unsignedRightShift');

// https://262.ecma-international.org/12.0/#sec-applystringornumericbinaryoperator

// https://262.ecma-international.org/12.0/#step-applystringornumericbinaryoperator-operations-table
var table = {
	'**': [NumberExponentiate, BigIntExponentiate],
	'*': [NumberMultiply, BigIntMultiply],
	'/': [NumberDivide, BigIntDivide],
	'%': [NumberRemainder, BigIntRemainder],
	'+': [NumberAdd, BigIntAdd],
	'-': [NumberSubtract, BigIntSubtract],
	'<<': [NumberLeftShift, BigIntLeftShift],
	'>>': [NumberSignedRightShift, BigIntSignedRightShift],
	'>>>': [NumberUnsignedRightShift, BigIntUnsignedRightShift],
	'&': [NumberBitwiseAND, BigIntBitwiseAND],
	'^': [NumberBitwiseXOR, BigIntBitwiseXOR],
	'|': [NumberBitwiseOR, BigIntBitwiseOR]
};

module.exports = function ApplyStringOrNumericBinaryOperator(lval, opText, rval) {
	if (Type(opText) !== 'String' || !HasOwnProperty(table, opText)) {
		throw new $TypeError('Assertion failed: `opText` must be a valid operation string');
	}
	if (opText === '+') {
		var lprim = ToPrimitive(lval);
		var rprim = ToPrimitive(rval);
		if (Type(lprim) === 'String' || Type(rprim) === 'String') {
			var lstr = ToString(lprim);
			var rstr = ToString(rprim);
			return lstr + rstr;
		}
		/* eslint no-param-reassign: 1 */
		lval = lprim;
		rval = rprim;
	}
	var lnum = ToNumeric(lval);
	var rnum = ToNumeric(rval);
	var T = Type(lnum);
	if (T !== Type(rnum)) {
		throw new $TypeError('types of ' + lnum + ' and ' + rnum + ' differ');
	}
	var Operation = table[opText][T === 'BigInt' ? 1 : 0];
	return Operation(lnum, rnum);
};
